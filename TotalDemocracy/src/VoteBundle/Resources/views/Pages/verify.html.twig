{% extends "::base.html.twig" %}

{% block content %}

    <h1>Verify</h1>

    {% if image is defined %}
        <form action="{{ path("finish_verify") }}" method="post">
            <p>
                <label>Given Names</label><input type="text" id="names-input" name="names" value="{{ givenNames }}">
            </p>
            <p>
                <label>Surname</label><input type="text" id="surname-input" name="surname" value="{{ surname }}">
            </p>
            <p>
                <label>Date of Birth:</label>
                <select id="dob-date" name="dobDate">
                    <option value=""></option>
                    {% for i in 1..31 %}
                        <option value="{{ i }}" {% if dobDate is defined and dobDate == i %}selected{% endif %}>{{ i }}</option>
                    {% endfor %}
                </select>
                <select id="dob-month" name="dobMonth">
                    <option value=""></option>
                    {% for i in 1..12 %}
                        <option value="{{ i }}" {% if dobMonth is defined and dobMonth == i %}selected{% endif %}>{{ month_names[i - 1] }}</option>
                    {% endfor %}
                </select>
                <select id="dob-year" name="dobYear">
                    <option value=""></option>
                    {% for year in years %}
                        <option value="{{ year }}" {% if dobYear is defined and dobYear == year %}selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                </select>
            </p>
            <p>
                <label>Postcode</label><input type="text" id="postcode-input" name="postcode" value="{{ postcode }}">
            </p>
            <p>
                <label>Suburb/Locality</label><select id="suburb-select" name="suburb" disabled>
                    <option>- None Selected -</option>
                </select>
            </p>
            <p>
                <label>Street Number</label><input type="text" class="street-inputs" id="street-number-input" name="streetNumber" value="{{ streetNumber }}" disabled>
            </p>
            <p>
                <label>Street</label><input type="text" class="street-inputs" id="street-input" name="street" value="{{ street }}" disabled>
            </p>
            <p>
                <img src="{{ image }}">
            </p>
            <p>
                <label>Verification Code</label><input type="text" id="verify-input" name="verify">
            </p>

            <h4 id="error-text" class="color-red">
                {% if app.session.flashbag.has('error-redirect') %}
                    {% for error in app.session.flashbag.get('error-redirect') %}
                        {{ error }}
                    {% endfor %}
                {% endif %}
            </h4>

            <button type="submit" id="verify-submit" class="btn btn-success">Verify</button>
        </form>
    {% else %}
        <p>No Image</p>
    {% endif %}
    {% if message is defined %}
        <h2>{{ message }}</h2>
    {% endif %}


{% endblock %}

{% block javascripts %}
    {% javascripts '@address_autocomplete' %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %}
    <script>

        $(document).ready(function() {

            var $postcode_input = $("#postcode-input");
            var $suburb_select = $("#suburb-select");
            var $street_input = $("#street-input");
            var $all_street_inputs = $(".street-inputs");
            var $error = $("#error-text");

            var address_verify = createAddressAutoComplete($postcode_input, $suburb_select, $street_input, $all_street_inputs);

            // TODO: drop in a jquery form validator
            $("#verify-submit").click(function() {

                if($("#names-input").val().length < 1) {
                    $error.html("Enter your given names");
                    return false;
                }
                if($("#surname-input").val().length < 1) {
                    $error.html("Enter your surname");
                    return false;
                }
                if( ($("#dob-date option:selected").prop("value").length < 1) ||
                        ($("#dob-month option:selected").prop("value").length < 1) ||
                        ($("#dob-year option:selected").prop("value").length < 1)
                ) {
                    $error.html("Enter a valid birth date");
                    return false;
                }

                var result = address_verify();
                if(result !== true) {
                    $error.html(result);
                    return false;
                }
                if($("#verify-input").val().length !== 4) {
                    $error.html("Enter the four letters/numbers in the image");
                    return false;
                }
            });

        });
    </script>
{% endblock %}
